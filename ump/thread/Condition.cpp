/***********************************************************************//**
	@file
***************************************************************************/
#include "ump/thread/Condition.hpp"

namespace ump {
namespace thread {
/***********************************************************************//**
	@brief 
***************************************************************************/
Condition::Condition()
  : notify_(false)
{
}
/***********************************************************************//**
	@brief 
***************************************************************************/
void Condition::notify() {
  {
    std::lock_guard<std::mutex> lock(mutex_);
    notify_ = true;
  }
  condition_.notify_one();
}
/***********************************************************************//**
	@brief 
***************************************************************************/
void Condition::wait() {
  std::unique_lock<std::mutex> lock(mutex_);
  condition_.wait(lock, 
                  [&]() {
                    return isNotify();
                  });
}
/***********************************************************************//**
	@brief 
***************************************************************************/
bool Condition::wait(int ms) {
  std::unique_lock<std::mutex> lock(mutex_);
  condition_.wait_for(lock, 
                      std::chrono::milliseconds(ms), 
                      [&]() {
                        return isNotify();
                      });
  return !isNotify();
}
/***********************************************************************//**
	@brief 
***************************************************************************/
void Condition::reset() {
  std::unique_lock<std::mutex> lock(mutex_);
  notify_ = false;
}
/***********************************************************************//**
	$Id$
***************************************************************************/
}
}
